var marqdoujAzureMaps;(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Animations:()=>q,Controls:()=>x,Events:()=>V,Features:()=>O,Geolocation:()=>H,ImageSprite:()=>_,Layers:()=>z,MapFactory:()=>U,Maps:()=>J,Markers:()=>j,Mercator:()=>Z,Popups:()=>W,Sources:()=>T});const a=atlas;var o,r,n,s,i,l,d,c,p,u,g,v,m,y,h,f,M,E,I,b=e.n(a);!function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Information=2]="Information",e[e.Warn=3]="Warn",e[e.Error=4]="Error",e[e.Critical=5]="Critical",e[e.None=6]="None"}(o||(o={}));class S{static currentLevel=o.Information;static GetMapHeader(e){return`Map with Id '${e}'`}static logMessage(e,t,a,...r){if(t<this.currentLevel)return;const n=`${this.GetMapHeader(e)} ${a}`;switch(t){case o.Trace:console.trace(n,...r);break;case o.Debug:console.debug(n,...r);break;case o.Information:console.info(n,...r);break;case o.Warn:console.warn(n,...r);break;case o.Error:console.error(n,...r);break;case o.Critical:console.error(`CRITICAL: ${n}`,...r)}}}class k{#e=new Map;mapId;constructor(e){this.mapId=e}addCallback(e,t){const a=this.#t(e);this.#e.has(a)||(this.#e.set(a,t),S.logMessage(this.mapId,o.Trace,"EventsMap-addCallback:",a))}getCallback(e,t){const a=this.#t(e);if(this.#e.has(a)){const e=this.#e.get(a);if(t){const e=this.#e.delete(a);S.logMessage(this.mapId,o.Trace,"EventsMap-removeCallback:",a,e)}return e}}#t(e){return`${e.target}.${e.type}.${e.targetId}`}clear(){this.#e.clear()}}class C{#a;#e;#o;#r;constructor(e,t,a){this.#a=e,this.#r=t,this.#o=a,this.#e=new k(t)}get dotNetRef(){return this.#a}get eventsMap(){return this.#e}get mapId(){return this.#r}get map(){return this.#o}clear(){this.#a=null,this.#r=null,this.#o=null,this.#e.clear()}}class N{static safeStringify(e){const t=new WeakSet;return JSON.stringify(e,(e,a)=>{if("object"==typeof a&&null!==a){if(t.has(a))return;t.add(a)}return a})}static parseJsonString(e){return JSON.parse(e)}static isEmptyOrNull(e){return null==e||""===e.trim()}static isNotEmptyOrNull(e){return!this.isEmptyOrNull(e)}static isValueInEnum(e,t){return Object.values(e).includes(t)}static isJsInteropDef(e){return e&&null!=e.jsInterop&&null!=e.jsInterop.interopId}static getJsInterop(e){if(this.isJsInteropDef(e))return e.jsInterop}static isFeature(e){return e&&"Feature"===e.type}static isShape(e){return e&&null!=e.getType}static getFeatureResult(e){return{jsInterop:this.getJsInterop(e),id:e.id?.toString(),type:e.geometry.type,bbox:e.bbox,source:"feature",properties:e.properties}}static getShapeResult(e){return{jsInterop:this.getJsInterop(e),id:e.getId()?.toString(),type:e.getType(),bbox:e.getBounds(),source:"shape",properties:e.getProperties()}}static buildShapeResults(e){const t=[];return e.filter(e=>this.isFeature(e)).forEach(e=>{t.push(this.getFeatureResult(e))}),e.filter(e=>this.isShape(e)).forEach(e=>{t.push(this.getShapeResult(e))}),t}static isInteropControl(e,t){let a=this.isJsInteropDef(e);return a&&N.isNotEmptyOrNull(t)&&(a=e.jsInterop.id===t||e.jsInterop.interopId===t),a}static isInteropLayer(e,t){let a=this.isJsInteropDef(e);return a&&N.isNotEmptyOrNull(t)&&(a=e.jsInterop.id===t||e.jsInterop.interopId===t),a}}class D{static logEventAdd(e,t,a,r){a?S.logMessage(e,o.Trace,`${t}: event added:`,r):S.logMessage(e,o.Error,`${t}: event not supported:`,r)}static logEventRemoved(e,t,a,r){a?S.logMessage(e,o.Trace,`${t}: event removed:`,r):S.logMessage(e,o.Error,`${t}: event not supported:`,r)}static logInvalidTargetId(e,t,a){S.logMessage(e,o.Error,`${t}: 'once' is not supported:`,a),S.logMessage(e,o.Error,`${t}: invalid TargetId.`,a)}static logOnceNotSupported(e,t,a){S.logMessage(e,o.Error,`${t}: 'once' is not supported:`,a)}static logNotifyFired(e,t,...a){S.logMessage(e,o.Trace,`${t}: event was fired.`,a)}static logMessage(e,t,a,...o){S.logMessage(e,t,a,o)}}class R{static buildEventResult(e,t,a){return{mapId:e,type:t.type,target:t.target,payload:{targetId:t.targetId,...a}}}static buildShapeResults(e){const t=[];return e.filter(e=>N.isFeature(e)).forEach(e=>{t.push(N.getFeatureResult(e))}),e.filter(e=>N.isShape(e)).forEach(e=>{t.push(N.getShapeResult(e))}),t}static buildDataSourcePayload(e){return{id:e.getId(),jsInterop:N.getJsInterop(e)}}static buildLayerPayload(e){return{id:e.getId(),jsInterop:N.getJsInterop(e)}}static buildMouseEventPayload(e){return{mouse:{layerId:e.layerId,pixel:e.pixel,position:e.position,shapes:this.buildShapeResults(e.shapes)}}}static buildTargetedEventPayload(e){return{jsInterop:e.target.jsInterop,type:e.type}}static buildTouchEventPayload(e){return{pixel:e.pixel,pixels:e.pixels,position:e.position,positions:e.positions,layerId:e.layerId,shapes:this.buildShapeResults(e.shapes)}}static buildWheelEventPayload(e){return{type:e.type}}}class w{add(e,t,a){0!=t.length&&this.#n(e,this.#s(t),a)}remove(e,t,a){0!=t.length&&this.#i(e,this.#s(t),a)}#s(e){return Object.values(e).filter(e=>"layer"===e.target&&N.isValueInEnum(r,e.type))}#n(e,t,a){if(0==t.length)return;const o="addLayerEvents",r=e.map;t.forEach(t=>{let n=!1;const s=a??this.#l(r,t);if(a&&(t.targetId=a.getId()),!s)return void D.logInvalidTargetId(e.mapId,o,t);const i=this.#d(e,t,!1);i&&s&&(t.once?r.events.addOnce(t.type,s,i):r.events.add(t.type,s,i),n=!0),D.logEventAdd(e.mapId,o,n,t)})}#i(e,t,a){if(0==t.length)return;const o="removeLayerEvents",r=e.map;t.forEach(t=>{let n=!1;const s=a??this.#l(r,t);if(a&&(t.targetId=a.getId()),!s)return void D.logInvalidTargetId(e.mapId,o,t);const i=this.#d(e,t,!0);i&&(s?(r.events.remove(t.type,s,i),n=!0):D.logInvalidTargetId(e.mapId,o,t)),D.logEventRemoved(e.mapId,o,n,t)})}#l(e,t){if("layer"===t.target)return e.layers.getLayerById(t.targetId)}#d(e,t,a){let o=e.eventsMap.getCallback(t,a);if(o)return o;switch(t.type){case r.LayerAdded:case r.LayerRemoved:o=a=>this.#c(a,e,t);break;case r.Click:case r.ContextMenu:case r.DblClick:case r.MouseDown:case r.MouseEnter:case r.MouseLeave:case r.MouseMove:case r.MouseOut:case r.MouseOver:case r.MouseUp:o=a=>this.#p(a,e,t);break;case r.TouchCancel:case r.TouchEnd:case r.TouchMove:case r.TouchStart:o=o=a=>this.#u(a,e,t);break;case r.Wheel:o=a=>this.#g(a,e,t)}return e.eventsMap.addCallback(t,o),o}#c=(e,t,a)=>{let o=R.buildEventResult(t.mapId,a,R.buildLayerPayload(e));t.dotNetRef.invokeMethodAsync(h.NotifyMapEventLayer,o),D.logNotifyFired(t.mapId,h.NotifyMapEventLayer,a.type)};#u=(e,t,a)=>{a.preventDefault&&e.preventDefault();let o={id:a.targetId,touch:R.buildTouchEventPayload(e)},r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventLayer,r),D.logNotifyFired(t.mapId,h.NotifyMapEventLayer,a.type)};#p=(e,t,a)=>{a.preventDefault&&e.preventDefault();let o={id:a.targetId,mouse:R.buildMouseEventPayload(e)},r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventLayer,r),D.logNotifyFired(t.mapId,h.NotifyMapEventLayer,a.type)};#g=(e,t,a)=>{a.preventDefault&&e.preventDefault();let o={id:a.targetId,wheel:R.buildWheelEventPayload(e)},r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventLayer,r),D.logNotifyFired(t.mapId,h.NotifyMapEventLayer,a.type)}}!function(e){e.LayerAdded="layeradded",e.LayerRemoved="layerremoved",e.Click="click",e.ContextMenu="contextmenu",e.DblClick="dblclick",e.MouseDown="mousedown",e.MouseEnter="mouseenter",e.MouseLeave="mouseleave",e.MouseMove="mousemove",e.MouseOut="mouseout",e.MouseOver="mouseover",e.MouseUp="mouseup",e.TouchCancel="touchcancel",e.TouchEnd="touchend",e.TouchMove="touchmove",e.TouchStart="touchstart",e.Wheel="wheel"}(r||(r={}));class O{static async add(e,t,a,o){const r=U.getMapReference(e);if(!r)return;const n=P.getSource(r,a);n&&(t??=[],t.forEach(e=>{this.#v(r,e,n,o)}))}static#v(e,t,r,s){if(r instanceof a.source.DataSource==0)return void S.logMessage(e.mapId,o.Error,`adding feature: source with ID '${r.getId()}' is not a DataSource`);if(s&&t.id){const e=r.getShapeById(t.id);e&&r.remove(e)}let i;switch(t.geometry.type.toLowerCase()){case n.Point:i=new a.data.Point(t.geometry.coordinates);break;case n.MultiPoint:i=new a.data.MultiPoint(t.geometry.coordinates,t.bbox);break;case n.LineString:i=new a.data.LineString(t.geometry.coordinates,t.bbox);break;case n.Polygon:i=new a.data.Polygon(t.geometry.coordinates,t.bbox)}if(!i)return void S.logMessage(e.mapId,o.Error,`adding feature error: geometry type '${t.geometry.type}' not supported`);const l={id:t.id,interopId:t.interopId},d={...t.properties,jsInterop:l};let c=new a.data.Feature(i,d,t.id);if(t.asShape){let e=new a.Shape(c);r.add(e)}else r.add(c)}static update(e,t,a){const o=U.getMapReference(e);if(!o)return;const r=P.getDataSource(o,a);r&&t.forEach(e=>{const t=r.getShapeById(e.id);t&&(t.setCoordinates(e.geometry.coordinates),t.setProperties(e.properties))})}static getCoordinates(e,t,a){const o=U.getMapReference(e);if(!o)return;const r=P.getDataSource(o,a);if(!r)return;const n=r.getShapeById(t);return n?n.getCoordinates():void 0}static setCoordinates(e,t,a,o){const r=U.getMapReference(e);if(!r)return;const n=P.getDataSource(r,o);if(!n)return;const s=n.getShapeById(t);s&&s.setCoordinates(a)}static getProperties(e,t,a){const o=U.getMapReference(e);if(!o)return;const r=P.getDataSource(o,a);if(!r)return;const n=r.getShapeById(t);return n?n.getProperties():void 0}static setProperties(e,t,a,o,r=!1){const n=U.getMapReference(e);if(!n)return;const s=P.getDataSource(n,o);if(!s)return;const i=s.getShapeById(t);if(i)if(r)i.setProperties(a);else{let e=i.getProperties();e={...e,...a},i.setProperties(e)}}static addProperty(e,t,a,o,r){const n=U.getMapReference(e);if(!n)return;const s=P.getDataSource(n,r);if(!s)return;const i=s.getShapeById(t);i&&i.addProperty(a,o)}}!function(e){e.Point="point",e.MultiPoint="multipoint",e.LineString="linestring",e.MultiLineString="multilinestring",e.Polygon="polygon",e.MultiPolygon="multipolygon"}(n||(n={}));class T{static add(e,t,a,o){const r=U.getMapReference(e);r&&(t??=[],t.forEach(e=>{this.#m(r,e,a,o)}))}static#m(e,t,a,r){"DataSource"===t.type?this.#y(e,t,a,r):S.logMessage(e.mapId,o.Warn,`add: unsupported source type: ${t.type}`)}static#y(e,t,r,n){if(N.isEmptyOrNull(t.id))return void S.logMessage(e.mapId,o.Error,"addDataSource: missing ID.",t);if(e.map.sources.getById(t.id))return void S.logMessage(e.mapId,o.Warn,`addDataSource: source with ID '${t.id}' already exists.`);const s=new a.source.DataSource(t.id,t.options),i={id:t.id,interopId:t.interopId};s.jsInterop=i,r&&V.sources.add(e,r,s),e.map.sources.add(s),t.url&&s.importDataFromUrl(t.url),n&&O.add(e.mapId,n,t.id)}static remove(e,t){const a=U.getMapReference(e);if(!a)return;const o=[];t.forEach(e=>{o.push(e.id)}),this.#h(a,o)}static removeById(e,t){if(0==t.length)return;const a=U.getMapReference(e);a&&this.#h(a,t)}static#h(e,t){t.forEach(t=>{const a=e.map.sources.getById(t);a?(e.map.sources.remove(a),S.logMessage(e.mapId,o.Debug,`remove: source with ID '${t}' was removed.`)):S.logMessage(e.mapId,o.Warn,`remove: source with ID '${t}' was not found.`)})}static clear(e,t){const a=U.getMapReference(e);if(!a)return;const o=[];t.forEach(e=>{o.push(e.id)}),this.#f(a,o)}static clearById(e,t){const a=U.getMapReference(e);a&&this.#f(a,t)}static#f(e,t){t.forEach(t=>{const a=e.map.sources.getById(t);a?null!=a.clear?(a.clear(),S.logMessage(e.mapId,o.Debug,`clear: source with ID '${t}' was cleared.`)):S.logMessage(e.mapId,o.Warn,`clear: source with ID '${t}' does not support 'clear'.`):S.logMessage(e.mapId,o.Warn,`clear: source with ID '${t}' was not found.`)})}static getShapes(e,t){const r=U.getMapReference(e);if(!r)return;const n=P.getSource(r,t);return n&&(n instanceof a.source.DataSource?N.buildShapeResults(n.getShapes()):S.logMessage(e,o.Warn,`getShapes: source with ID '${t}' does not support 'getShapes'.`)),[]}}class P{static getSource(e,t){const a=e.map.sources.getById(t);return a||S.logMessage(e.mapId,o.Warn,`get: source with ID '${t}' was not found.`),a}static getDataSource(e,t,a=o.Error){const r=this.getSource(e,t);if(r){if(this.isDataSource(r))return r;S.logMessage(e.mapId,a,`getDataSource: source with ID '${t}' is not a DataSource`)}}static isDataSource(e){return e&&e instanceof a.source.DataSource}}class L{add(e,t,a){if(0==t.length)return;if(a&&!P.isDataSource(a))return void D.logMessage(e.mapId,o.Error,"SourceEvents: Unsupported source type for adding events.",a);const r=this.#s(t);0!=r.length&&this.#M(e,a,r)}remove(e,t,a){if(0==t.length)return;if(a&&!P.isDataSource(a))return void D.logMessage(e.mapId,o.Error,"SourceEvents: Unsupported source type for removing events.",a);const r=this.#s(t);0!=r.length&&this.#E(e,a,r)}#s(e){return Object.values(e).filter(e=>"datasource"===e.target&&N.isValueInEnum(s,e.type))}#M(e,t,a){if(0==a.length)return;const o=e.map,r="addDataSourceEvents";a.forEach(a=>{const n=t??this.#I(e,a);let s=!1;if(t&&(a.targetId=t.getId()),n){const t=this.#d(e,a,!1);t&&(a.once?o.events.addOnce(a.type,n,t):o.events.add(a.type,n,t),s=!0),D.logEventAdd(e.mapId,r,s,a)}else D.logInvalidTargetId(e.mapId,r,a)})}#E(e,t,a){if(0==a.length)return;const o=e.map,r="removeDataSourceEvents";a.forEach(a=>{const n=t??this.#I(e,a);let s=!1;if(t&&(a.targetId=t.getId()),n){const t=this.#d(e,a,!0);t&&(o.events.remove(a.type,n,t),s=!0),D.logEventRemoved(e.mapId,r,s,a)}else D.logInvalidTargetId(e.mapId,r,a)})}#d(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=t.type.toLowerCase()===s.DataSourceUpdated?a=>this.#b(a,e,t):a=>this.#S(a,e,t),e.eventsMap.addCallback(t,o),o)}#I(e,t){const o=P.getSource(e,t.targetId);if(o instanceof a.source.DataSource)return o}#b=(e,t,a)=>{let o=R.buildEventResult(t.mapId,a,R.buildDataSourcePayload(e));t.dotNetRef.invokeMethodAsync(h.NotifyMapEventDataSource,o),D.logNotifyFired(t.mapId,h.NotifyMapEventDataSource,a.type)};#S=(e,t,a)=>{let o={shapes:N.buildShapeResults(e)},r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventDataSource,r),D.logNotifyFired(t.mapId,h.NotifyMapEventDataSource,a.type,r)}}!function(e){e.DataSourceUpdated="datasourceupdated",e.DataAdded="dataadded",e.DataRemoved="dataremoved"}(s||(s={}));class A{add(e,t){0!=t.length&&this.#k(e,this.#s(t))}remove(e,t){0!=t.length&&this.#C(e,this.#s(t))}#s(e){return Object.values(e).filter(e=>"map"===e.target)}#k(e,t){0!=t.length&&(this.#N(e,t),this.#D(e,t),this.#R(e,t),this.#w(e,t),this.#O(e,t),this.#T(e,t),this.#P(e,t),this.#L(e,t),this.#A(e,t))}#C(e,t){0!=t.length&&(this.#j(e,t),this.#$(e,t),this.#W(e,t),this.#B(e,t),this.#F(e,t),this.#x(e,t),this.#G(e,t),this.#V(e,t),this.#H(e,t))}#N(e,t){if(0==t.length)return;const a="addMapEventConfig";Object.values(t).filter(e=>N.isValueInEnum(i,e.type)).forEach(t=>{let o=!1;const r=this.#U(e,t,!1);r&&(t.once?D.logOnceNotSupported(e.mapId,a,t):(e.map.events.add(t.type,r),o=!0)),D.logEventAdd(e.mapId,a,o,t)})}#j(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(i,e.type)).forEach(t=>{let a=!1;const o=this.#U(e,t,!0);o&&(e.map.events.remove(t.type,o),a=!0),D.logEventRemoved(e.mapId,"removeMapEventConfig",a,t)})}#U(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#z(a,e,t),e.eventsMap.addCallback(t,o),o)}#z=(e,t,a)=>{let o=R.buildEventResult(t.mapId,a,e);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventConfig,o),D.logNotifyFired(t.mapId,h.NotifyMapEventConfig,a.type)};#D(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(l,e.type)).forEach(t=>{let a=!1;const o=this.#J(e,t,!1);o&&(t.once?e.map.events.addOnce(t.type,o):e.map.events.add(t.type,o),a=!0),D.logEventAdd(e.mapId,"addMapEventData",a,t)})}#$(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(l,e.type)).forEach(t=>{let a=!1;const o=this.#J(e,t,!0);o&&(e.map.events.remove(t.type,o),a=!0),D.logEventRemoved(e.mapId,"removeMapEventData",a,t)})}#J(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#Z(a,e,t),e.eventsMap.addCallback(t,o),o)}#Z=(e,t,a)=>{let o=R.buildEventResult(t.mapId,a,this.#_(e));t.dotNetRef.invokeMethodAsync(h.NotifyMapEventData,o),D.logNotifyFired(t.mapId,h.NotifyMapEventData,a.type)};#_(e){return{dataType:e.dataType,isSourceLoaded:e.isSourceLoaded,source:e.source?.getId(),sourceDataType:e.sourceDataType,tile:e.tile}}#R(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(d,e.type)).forEach(t=>{let a=!1;const o=this.#q(e,t,!1);o&&(t.once?e.map.events.addOnce(t.type,o):e.map.events.add(t.type,o),a=!0),D.logEventAdd(e.mapId,"addMapEventGeneral",a,t)})}#W(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(d,e.type)).forEach(t=>{let a=!1;const o=this.#q(e,t,!0);o&&(e.map.events.remove(t.type,o),a=!0),D.logEventRemoved(e.mapId,"removeMapEventGeneral",a,t)})}#q(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>{this.#K(a,e,t)},e.eventsMap.addCallback(t,o),o)}#K=(e,t,a)=>{let o=R.buildEventResult(t.mapId,a);t.dotNetRef.invokeMethodAsync(h.NotifyMapEvent,o),D.logNotifyFired(t.mapId,h.NotifyMapEvent,a.type)};#w(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(c,e.type)).forEach(t=>{let a=!1;const o=this.#Q(e,t,!1);o&&(t.once?e.map.events.addOnce(t.type,o):e.map.events.add(t.type,o),a=!0),D.logEventAdd(e.mapId,"addMapEventLayer",a,t)})}#B(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(c,e.type)).forEach(t=>{let a=!1;const o=this.#Q(e,t,!0);o&&(e.map.events.remove(t.type,o),a=!0),D.logEventRemoved(e.mapId,"removeMapEventLayer",a,t)})}#Q(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>{this.#c(a,e,t)},e.eventsMap.addCallback(t,o),o)}#c=(e,t,a)=>{let o=R.buildEventResult(t.mapId,a,R.buildLayerPayload(e));t.dotNetRef.invokeMethodAsync(h.NotifyMapEventGeneral,o),D.logNotifyFired(t.mapId,h.NotifyMapEventGeneral,a.type)};#O(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(f,e.type)).forEach(t=>{let a=!1,o=this.#X(e,t,!1);o&&(t.once?e.map.events.addOnce(t.type,o):e.map.events.add(t.type,o),a=!0),D.logEventAdd(e.mapId,"addMapEventMouse",a,t)})}#F(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(f,e.type)).forEach(t=>{let a=!1,o=this.#X(e,t,!0);o&&(e.map.events.remove(t.type,o),a=!0),D.logEventRemoved(e.mapId,"removeMapEventMouse",a,t)})}#X(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#Y(a,e,t),e.eventsMap.addCallback(t,o),o)}#Y=(e,t,a)=>{a.preventDefault&&e.preventDefault();let o=R.buildMouseEventPayload(e),r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventMouse,r),D.logNotifyFired(t.mapId,h.NotifyMapEventMouse,a.type)};#T(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(p,e.type)).forEach(t=>{let a=!1;const o=this.#ee(e,t,!1);o&&(t.once?e.map.events.addOnce(t.type,o):e.map.events.add(t.type,o),a=!0),D.logEventAdd(e.mapId,"addMapEventSource",a,t)})}#x(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(p,e.type)).forEach(t=>{let a=!1;const o=this.#ee(e,t,!0);o&&(e.map.events.remove(t.type,o),a=!0),D.logEventRemoved(e.mapId,"removeMapEventSource",a,t)})}#ee(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#te(a,e,t),e.eventsMap.addCallback(t,o),o)}#te(e,t,a){let o={id:e.getId(),jsInterop:N.getJsInterop(e)},r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventSource,r),D.logNotifyFired(t.mapId,h.NotifyMapEventSource,a.type)}#P(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(u,e.type)).forEach(t=>{let a=!1;const o=this.#ae(e,t,!1);o&&(t.once?e.map.events.addOnce(t.type,o):e.map.events.add(t.type,o),a=!0),D.logEventAdd(e.mapId,"addMapEventStyle",a,t)})}#G(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(u,e.type)).forEach(t=>{let a=!1;const o=this.#ae(e,t,!0);o&&(e.map.events.remove(t.type,o),a=!0),D.logEventRemoved(e.mapId,"removeMapEventStyle",a,t)})}#ae(e,t,a){let o=e.eventsMap.getCallback(t,a);if(o)return o;switch(t.type.toLowerCase()){case u.StyleChanged:o=a=>this.#oe(a.style,e,t);break;case u.StyleImageMissing:o=a=>this.#oe(a,e,t)}return e.eventsMap.addCallback(t,o),o}#oe(e,t,a){let o={style:e},r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventStyle,r),D.logNotifyFired(t.mapId,h.NotifyMapEventStyle,a.type)}#L(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(M,e.type)).forEach(t=>{let a=!1;const o=this.#re(e,t,!1);o&&(t.once?e.map.events.addOnce(t.type,o):e.map.events.add(t.type,o),a=!0),D.logEventAdd(e.mapId,"addMapEventTouch",a,t)})}#V(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(M,e.type)).forEach(t=>{let a=!1;const o=this.#re(e,t,!0);o&&(e.map.events.remove(t.type,o),a=!0),D.logEventRemoved(e.mapId,"removeMapEventTouch",a,t)})}#re(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#ne(a,e,t),e.eventsMap.addCallback(t,o),o)}#ne=(e,t,a)=>{a.preventDefault&&e.preventDefault();let o=R.buildTouchEventPayload(e),r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventTouch,r),D.logNotifyFired(t.mapId,h.NotifyMapEventTouch,a.type)};#A(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(E,e.type)).forEach(t=>{let a=!1,o=this.#se(e,t,!1);o&&(t.once?e.map.events.addOnce(t.type,o):e.map.events.add(t.type,o),a=!0),D.logEventAdd(e.mapId,"addMapEventWheel",a,t)})}#H(e,t){0!=t.length&&Object.values(t).filter(e=>N.isValueInEnum(E,e.type)).forEach(t=>{let a=!1,o=this.#se(e,t,!0);o&&(e.map.events.remove(t.type,o),a=!0),D.logEventRemoved(e.mapId,"removeMapEventWheel",a,t)})}#se(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#ie(a,e,t),e.eventsMap.addCallback(t,o),o)}#ie=(e,t,a)=>{a.preventDefault&&e.preventDefault();let o=R.buildWheelEventPayload(e),r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventWheel,r),D.logNotifyFired(t.mapId,h.NotifyMapEventWheel,a.type)}}!function(e){e.MapConfigChanged="mapconfigurationchanged"}(i||(i={})),function(e){e.Data="data",e.SourceData="sourcedata",e.StyleData="styledata"}(l||(l={})),function(e){e.BoxZoomEnd="boxzoomend",e.BoxZoomStart="boxzoomstart",e.Drag="drag",e.DragEnd="dragend",e.DragStart="dragstart",e.Idle="idle",e.Load="load",e.Move="move",e.MoveEnd="moveend",e.MoveStart="movestart",e.Pitch="pitch",e.PitchEnd="pitchend",e.PitchStart="pitchstart",e.Render="render",e.Resize="resize",e.Rotate="rotate",e.RotateEnd="rotateend",e.RotateStart="rotatestart",e.TokenAcquired="tokenacquired",e.Zoom="zoom",e.ZoomEnd="zoomend",e.ZoomStart="zoomstart"}(d||(d={})),function(e){e.LayerAdded="layeradded",e.LayerRemoved="layerremoved"}(c||(c={})),function(e){e.SourceAdded="sourceadded",e.SourceRemoved="sourceremoved"}(p||(p={})),function(e){e.StyleChanged="stylechanged",e.StyleImageMissing="styleimagemissing"}(u||(u={}));class j{static add(e,t){const o=U.getMapReference(e);o&&(t??=[],t.forEach(e=>{let t={...e.options};t.popup&&(t.popup=new a.Popup(t.popup.options));let r=new a.HtmlMarker(t);const n={id:e.id,interopId:e.interopId};r.jsInterop=n,o.map.markers.add(r),e.togglePopupOnClick&&o.map.events.add("click",r,()=>{r.togglePopup()})}))}static remove(e,t){const a=U.getMapReference(e);a&&t.forEach(e=>{let t=this.#le(a,e.interopId);t&&a.map.markers.remove(t)})}static getMarker(e,t){const a=U.getMapReference(e);if(a)return this.#le(a,t)}static#le(e,t){const a=e.map.markers.getMarkers().findLast(e=>this.#de(e,t));return a||S.logMessage(e.mapId,o.Debug,`getMarker: marker not found where id = '${t}'`),a}static#de(e,t){let a=e&&null!=e.jsInterop&&null!=e.jsInterop.interopId;return a&&N.isNotEmptyOrNull(t)&&(a=e.jsInterop.id===t||e.jsInterop.interopId===t),a}}class ${add(e,t){0!=t.length&&this.#ce(e,this.#s(t))}remove(e,t){0!=t.length&&this.#pe(e,this.#s(t))}#s(e){return Object.values(e).filter(e=>"htmlmarker"===e.target&&N.isValueInEnum(g,e.type))}#ce(e,t){if(0==t.length)return;const a="addHtmlMarkerEvents";t.forEach(t=>{const o=this.#l(e,t);let r=!1;if(o){const n=this.#d(e,t,!1);n&&(t.once?e.map.events.addOnce(t.type,o,n):e.map.events.add(t.type,o,n),r=!0),D.logEventAdd(e.mapId,a,r,t)}else D.logInvalidTargetId(e.mapId,a,t)})}#pe(e,t){if(0==t.length)return;const a="removeHtmlMarkerEvents";t.forEach(t=>{const o=this.#l(e,t);let r=!1;if(o){const n=this.#d(e,t,!0);n&&(e.map.events.remove(t.type,o,n),r=!0),D.logEventRemoved(e.mapId,a,r,t)}else D.logInvalidTargetId(e.mapId,a,t)})}#d(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#ue(a,e,t),e.eventsMap.addCallback(t,o),o)}#l(e,t){return j.getMarker(e.mapId,t.targetId)}#ue=(e,t,a)=>{let o=R.buildTargetedEventPayload(e),r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventHtmlMarker,r),D.logNotifyFired(t.mapId,h.NotifyMapEventHtmlMarker,a.type)}}!function(e){e.Click="click",e.ContextMenu="contextmenu",e.DblClick="dblclick",e.MouseDown="mousedown",e.MouseEnter="mouseenter",e.MouseLeave="mouseleave",e.MouseMove="mousemove",e.MouseOut="mouseout",e.MouseOver="mouseover",e.MouseUp="mouseup",e.Drag="drag",e.DragEnd="dragend",e.DragStart="dragstart",e.KeyDown="keydown",e.KeyPress="keypress",e.KeyUp="keyup"}(g||(g={}));class W{static add(e,t){const o=U.getMapReference(e);o&&(t??=[],t.forEach(e=>{let t=new a.Popup(e.options);const r={id:e.id,interopId:e.interopId};t.jsInterop=r,o.map.popups.add(t)}))}static remove(e,t){const a=U.getMapReference(e);a&&t.forEach(e=>{let t=this.#ge(a,e.interopId);t&&a.map.popups.remove(t)})}static getPopup(e,t){return this.#ge(e,t)}static#ge(e,t){const a=e.map.popups.getPopups().findLast(e=>this.#ve(e,t));return a||S.logMessage(e.mapId,o.Debug,`getPopup: popup not found where id = '${t}'`),a}static#ve(e,t){let a=e&&null!=e.jsInterop&&null!=e.jsInterop.interopId;return a&&N.isNotEmptyOrNull(t)&&(a=e.jsInterop.id===t||e.jsInterop.interopId===t),a}}class B{add(e,t){0!=t.length&&this.#me(e,this.#s(t))}remove(e,t){0!=t.length&&this.#ye(e,this.#s(t))}#s(e){return Object.values(e).filter(e=>"popup"===e.target&&N.isValueInEnum(v,e.type))}#me(e,t){if(0==t.length)return;const a="addPopupEvents";t.forEach(t=>{const o=this.#l(e,t);let r=!1;if(o){const n=this.#d(e,t,!1);n&&(t.once?e.map.events.addOnce(t.type,o,n):e.map.events.add(t.type,o,n),r=!0),D.logEventAdd(e.mapId,a,r,t)}else D.logInvalidTargetId(e.mapId,a,t)})}#ye(e,t){if(0==t.length)return;const a="removePopupEvents";t.forEach(t=>{const o=this.#l(e,t);let r=!1;if(o){const n=this.#d(e,t,!0);n&&(e.map.events.remove(t.type,o,n),r=!0),D.logEventRemoved(e.mapId,a,r,t)}else D.logInvalidTargetId(e.mapId,a,t)})}#d(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#he(a,e,t),e.eventsMap.addCallback(t,o),o)}#l(e,t){return W.getPopup(e,t.targetId)}#he=(e,t,a)=>{let o=R.buildTargetedEventPayload(e),r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventPopup,r),D.logNotifyFired(t.mapId,h.NotifyMapEventPopup,a.type)}}!function(e){e.Drag="drag",e.DragEnd="dragend",e.DragStart="dragstart",e.Open="open",e.Close="close"}(v||(v={}));class F{add(e,t){0!=t.length&&this.#fe(e,this.#s(t))}remove(e,t){0!=t.length&&this.#Me(e,this.#s(t))}#s(e){return Object.values(e).filter(e=>"shape"===e.target&&N.isValueInEnum(m,e.type))}#fe(e,t){if(0==t.length)return;const a="addShapeEvents";t.forEach(t=>{const o=this.#l(e,t);let r=!1;if(o){const n=this.#d(e,t,!1);n&&(t.once?e.map.events.addOnce(t.type,o,n):e.map.events.add(t.type,o,n),r=!0),D.logEventAdd(e.mapId,a,r,t)}else D.logInvalidTargetId(e.mapId,a,t)})}#Me(e,t){if(0==t.length)return;const a="removeShapeEvents";t.forEach(t=>{const o=this.#l(e,t);let r=!1;if(o){const n=this.#d(e,t,!0);n&&(e.map.events.remove(t.type,o,n),r=!0),D.logEventRemoved(e.mapId,a,r,t)}else D.logInvalidTargetId(e.mapId,a,t)})}#d(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#Ee(a,e,t),e.eventsMap.addCallback(t,o),o)}#l(e,t){const a=P.getSource(e,t.targetSourceId);if(P.isDataSource(a))return a.getShapeById(t.targetId)}#Ee=(e,t,a)=>{let o=N.getShapeResult(e),r=R.buildEventResult(t.mapId,a,o);t.dotNetRef.invokeMethodAsync(h.NotifyMapEventShape,r),D.logNotifyFired(t.mapId,h.NotifyMapEventShape,a.type)}}!function(e){e.ShapeChanged="shapechanged"}(m||(m={}));class x{static add(e,t){const r=U.getMap(e);r&&(t??=[],t.forEach(t=>{let n=null;switch(t.type.toLowerCase()){case"compass":n=new a.control.CompassControl(t.options);break;case"fullscreen":n=new a.control.FullscreenControl(t.options);break;case"pitch":n=new a.control.PitchControl(t.options);break;case"scale":n=new a.control.ScaleControl(t.options);break;case"style":n=new a.control.StyleControl(t.options);break;case"traffic":n=new a.control.TrafficControl(t.options);break;case"trafficlegend":n=new a.control.TrafficLegendControl;break;case"zoom":n=new a.control.ZoomControl(t.options);break;default:S.logMessage(e,o.Warn,`addControls: control type '${t.type}' is not supported.`)}if(n){const e={id:t.id,interopId:t.interopId,type:t.type};n.jsInterop=e,r.controls.add(n,t.controlOptions)}}))}static remove(e,t){const a=U.getMap(e);if(!a)return;const o=a.controls.getControls();t.forEach(t=>{let r=this.#Ie(o,e,t.interopId);r&&a.controls.remove(r)})}static getControl(e,t){const a=U.getMap(e);if(!a)return;const o=a.controls.getControls();return this.#Ie(o,e,t)}static#Ie(e,t,a){const r=e.findLast(e=>N.isInteropControl(e,a));return r||S.logMessage(t,o.Debug,`getControl: control not found where id = '${a}'`),r}static getControls(e){const t=U.getMap(e);if(!t)return;const a=t.controls.getControls(),o=[];return a.filter(e=>N.isInteropControl(e)).forEach(e=>{const t=e.jsInterop;t&&o.push(t)}),o}}class G{add(e,t){0!=t.length&&this.#be(e,this.#s(t))}remove(e,t){0!=t.length&&this.#Se(e,this.#s(t))}#s(e){return Object.values(e).filter(e=>"stylecontrol"===e.target&&N.isValueInEnum(y,e.type))}#be(e,t){if(0==t.length)return;const a="addStyleControlEvents";t.forEach(t=>{const o=x.getControl(e.mapId,t.targetId);if(o instanceof b().control.StyleControl){let r=!1;const n=this.#d(e,t,!1);n&&(t.once?e.map.events.addOnce(t.type,o,n):e.map.events.add(t.type,o,n),r=!0),D.logEventAdd(e.mapId,a,r,t)}else D.logInvalidTargetId(e.mapId,a,t)})}#Se(e,t){if(0==t.length)return;const a="removeStyleControlEvents";t.forEach(t=>{const o=x.getControl(e.mapId,t.targetId);if(o instanceof b().control.StyleControl){let r=!1;const n=this.#d(e,t,!0);n&&(e.map.events.remove(t.type,o,n),r=!0),D.logEventRemoved(e.mapId,a,r,t)}else D.logInvalidTargetId(e.mapId,a,t)})}#d(e,t,a){let o=e.eventsMap.getCallback(t,a);return o||(o=a=>this.#ke(a,e,t),e.eventsMap.addCallback(t,o),o)}#ke=(e,t,a)=>{let o=R.buildEventResult(t.mapId,a,{style:e});t.dotNetRef.invokeMethodAsync(h.NotifyMapEventStyle,o),D.logNotifyFired(t.mapId,h.NotifyMapEventStyle,a.type)}}!function(e){e.StyleSelected="styleselected"}(y||(y={}));class V{static layers=new w;static maps=new A;static markers=new $;static popups=new B;static shapes=new F;static sources=new L;static styleControls=new G;static add(e,t){const a=U.getMapReference(e);a&&(t??=[],this.layers.add(a,t),this.maps.add(a,t),this.markers.add(a,t),this.popups.add(a,t),this.shapes.add(a,t),this.sources.add(a,t),this.styleControls.add(a,t))}static remove(e,t){const a=U.getMapReference(e);a&&(this.layers.remove(a,t),this.maps.remove(a,t),this.markers.remove(a,t),this.popups.remove(a,t),this.shapes.remove(a,t),this.sources.remove(a,t),this.styleControls.remove(a,t))}}!function(e){e.MapError="NotifyMapEventError",e.MapReady="NotifyMapReady",e.NotifyMapEvent="NotifyMapEvent",e.NotifyMapEventConfig="NotifyMapEventConfig",e.NotifyMapEventData="NotifyMapEventData",e.NotifyMapEventDataSource="NotifyMapEventDataSource",e.NotifyMapEventGeneral="NotifyMapEventGeneral",e.NotifyMapEventHtmlMarker="NotifyMapEventHtmlMarker",e.NotifyMapEventLayer="NotifyMapEventLayer",e.NotifyMapEventMouse="NotifyMapEventMouse",e.NotifyMapEventPopup="NotifyMapEventPopup",e.NotifyMapEventShape="NotifyMapEventShape",e.NotifyMapEventSource="NotifyMapEventSource",e.NotifyMapEventStyle="NotifyMapEventStyle",e.NotifyMapEventTouch="NotifyMapEventTouch",e.NotifyMapEventWheel="NotifyMapEventWheel"}(h||(h={})),function(e){e.Click="click",e.ContextMenu="contextmenu",e.DblClick="dblclick",e.MouseDown="mousedown",e.MouseMove="mousemove",e.MouseOut="mouseout",e.MouseOver="mouseover",e.MouseUp="mouseup"}(f||(f={})),function(e){e.TouchCancel="touchcancel",e.TouchEnd="touchend",e.TouchMove="touchmove",e.TouchStart="touchstart"}(M||(M={})),function(e){e.Wheel="wheel"}(E||(E={}));class H{static#Ce=new Map;static async getLocation(e){const t={position:null,error:null},a=new Promise((t,a)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t,a,this.#Ne(e)):a({code:0,message:"This device does not support geolocation."})});return await a.then(e=>{t.position=e}).catch(e=>{t.error={code:e.code,message:e.message}}),t}static async watchPosition(e,t,a,r){if(!navigator.geolocation)return null;if(this.isWatched(t))return void S.logMessage(t,o.Warn,"Geolocation.watchPosition: watch has already been added.");const n=navigator.geolocation.watchPosition(o=>{if(this.isWatched(t)){const t={position:o,error:null};e.invokeMethodAsync(a,t)}},t=>{const o={position:null,error:{code:t.code,message:t.message}};e.invokeMethodAsync(a,o)},this.#Ne(r));return S.logMessage(t,o.Trace,"Geolocation.watchPosition:",n),this.#Ce.set(t,n),n}static clearWatch(e){if(navigator.geolocation&&this.#Ce.has(e)){const t=this.#Ce.get(e);S.logMessage(e,o.Trace,"Geolocation.clearWatch:",t),navigator.geolocation.clearWatch(t),this.#Ce.delete(e)}}static isWatched(e){return this.#Ce.has(e)}static#Ne(e){if(e){const t={};return e.enableHighAccuracy&&(t.enableHighAccuracy=e.enableHighAccuracy),e.maximumAge&&(t.maximumAge=e.maximumAge),e.timeout&&(t.timeout=e.timeout),t}}}class U{static#De=new Map;static getAuthTokenCallback;static createMap(e,t,r,n,s){if(S.currentLevel=r.logLevel??o.Information,this.#De.has(t))return void S.logMessage(t,o.Warn,"Map already exists.");const i=this.#Re(t,r.authOptions,r.options),l=new a.Map(t,i),d=new C(e,t,l);this.#De.set(t,d),S.logMessage(t,o.Debug,"was created."),x.add(t,s),this.#be(d,n)}static getMap(e){const t=this.getMapReference(e);return t?.map}static getMapReference(e){const t=this.#De.get(e);return t||S.logMessage(e,o.Debug,"MapManager was not found."),t}static removeMap(e){const t=this.#De.get(e);t&&(H.clearWatch(e),this.#De.delete(e)&&(t.clear(),S.logMessage(e,o.Debug,"was removed")))}static#Re(e,t,a){let r={};a&&(a.camera?r={...r,...a.camera}:a.cameraBounds&&(r={...r,...a.cameraBounds}),a.service&&(r={...r,...a.service}),a.style&&(r={...r,...a.style}),a.userInteraction&&(r={...r,...a.userInteraction})),r.authOptions=t;const n=t.sasTokenUrl;return N.isNotEmptyOrNull(n)?(S.logMessage(e,o.Trace,"buildMapOptions with SasTokenUrl:",n),r.authOptions.getToken=function(e,t,a){fetch(n).then(e=>e.text()).then(t=>e(t))}):r.authOptions.getToken=this.getAuthTokenCallback,r}static#be(e,t){const a=e.dotNetRef,r=e.mapId,n=e.map;n?(t??=[],n.events.addOnce(I.Ready,e=>{const s={target:"map",type:I.Error},i={target:"map",type:I.Ready};n.events.add(I.Error,e=>{const t={message:e.error.message,name:e.error.name,stack:e.error.stack,cause:e.error.cause};let n=R.buildEventResult(r,s,t);S.logMessage(r,o.Error,"Map error",n),a.invokeMethodAsync(h.MapError,n)}),V.add(r,t);let l=R.buildEventResult(r,i);a.invokeMethodAsync(h.MapReady,l)})):S.logMessage(r,o.Error,"Cannot build events. Map not found.")}}!function(e){e.Error="error",e.Ready="ready"}(I||(I={}));class z{static add(e,t,a){const o=U.getMapReference(e);o&&(t??=[],t.forEach(e=>{this.#we(o,e,a)}))}static#we(e,t,r){const n="addLayer";if(N.isEmptyOrNull(t.type))return void S.logMessage(e.mapId,o.Error,`${n}: layer type is missing`,t);const s=t.id;if(N.isEmptyOrNull(s))return void S.logMessage(e.mapId,o.Error,`${n}: layer Id is missing`,t);if(e.map.layers.getLayerById(s))return void S.logMessage(e.mapId,o.Error,`${n}: layer already exists where layer ID=${s}`,t);let i,l,d=t.dataSource;d&&N.isNotEmptyOrNull(d.id)&&(i=P.getSource(e,d.id),i||(T.add(e.mapId,[d],r),i=P.getSource(e,d.id)));const c=t.options||{};switch(t.type){case"Bubble":l=new a.layer.BubbleLayer(i,s,c);break;case"HeatMap":l=new a.layer.HeatMapLayer(i,s,c);break;case"Image":l=new a.layer.ImageLayer(c,s);break;case"Line":l=new a.layer.LineLayer(i,s,c);break;case"Polygon":l=new a.layer.PolygonLayer(i,s,c);break;case"PolygonExtrusion":l=new a.layer.PolygonExtrusionLayer(i,s,c);break;case"Symbol":this.#Oe(e.mapId,c),l=new a.layer.SymbolLayer(i,s,c);break;case"Tile":l=new a.layer.TileLayer(c,s)}let p=!1;if(l){const a={id:t.id,interopId:t.interopId};l.jsInterop=a,r&&V.layers.add(e,r,l),e.map.layers.add(l,t.before),p=!0}p?S.logMessage(e.mapId,o.Trace,`${n}: layer added:`,l):S.logMessage(e.mapId,o.Error,`${n}: layer type '${t.type}' is not supported.`,t)}static remove(e,t){let a=[];t.forEach(e=>{a.push(e.id)}),this.removeById(e,a),a=[],t.forEach(e=>{e.dataSource&&N.isNotEmptyOrNull(e.dataSource.id)&&a.push(e.dataSource.id)}),T.removeById(e,a)}static removeById(e,t){const a=U.getMapReference(e);if(!a)return;const r="removeLayer";t.forEach(t=>{const n=a.map.layers.getLayerById(t);n?(a.map.layers.remove(n),S.logMessage(e,o.Debug,`${r}: layer with id '${t}' was removed.`)):S.logMessage(e,o.Warn,`${r}: layer with id '${t}' was not found.`)})}static getOptions(e,t){const a=U.getMapReference(e);if(!a)return;const r=a.map.layers.getLayerById(t);if(!r)return void S.logMessage(e,o.Error,`LayerManager.getOptions: layer does not exist where layer ID=${t}`);let n=r.getOptions();return n.source=null,n}static setOptions(e,t){const a=U.getMapReference(e);if(!a)return;const r=N.parseJsonString(t),n=a.map.layers.getLayerById(r.id);if(!n)return void S.logMessage(e,o.Error,`LayerManager.setOptions: layer does not exist where layer ID=${r.id}`,r);let s=r.options||{};"Symbol"===r.type&&this.#Oe(e,s);let i=n.getOptions();i={...i,...s},n.setOptions(i)}static#Oe(e,t){const a=t.iconOptions;if(!a)return;const r=a.imageId;N.isNotEmptyOrNull(r)&&(a.image=r),a.rotationSpecification&&(a.rotation=["get","heading"]),S.logMessage(e,o.Trace,"resolveSymbolLayerOptions:",t)}}class J{static getCamera(e){const t=U.getMap(e);if(t)return t.getCamera()}static setCamera(e,t){const a=U.getMap(e);if(!a)return;let o=this.#Te(t);a.setCamera(o)}static#Te(e){let t={};return e.camera?t={...e.camera,...e.animation}:e.cameraBounds&&(t={...e.cameraBounds,...e.animation}),t}static getMapOptions(e){const t=U.getMap(e);if(t)return{mapCamera:t.getCamera(),service:t.getServiceOptions(),style:t.getStyle(),userInteraction:t.getUserInteraction()}}static setMapOptions(e,t){const a=U.getMap(e);if(!a)return;let o=this.#Te(t.camera);a.setCamera(o),t.service&&a.setServiceOptions(t.service),t.style&&a.setStyle(t.style),t.userInteraction&&a.setUserInteraction(t.userInteraction)}static getServiceOptions(e){const t=U.getMap(e);if(t)return t.getServiceOptions()}static setServiceOptions(e,t){const a=U.getMap(e);a&&a.setServiceOptions(t)}static getTraffic(e){const t=U.getMap(e);if(t)return t.getTraffic()}static setTraffic(e,t){const a=U.getMap(e);a&&a.setTraffic(t)}static getStyle(e){const t=U.getMap(e);if(t)return t.getStyle()}static setStyle(e,t){const a=U.getMap(e);a&&a.setStyle(t)}static getUserInteraction(e){const t=U.getMap(e);if(t)return t.getUserInteraction()}static setUserInteraction(e,t){const a=U.getMap(e);a&&a.setUserInteraction(t)}}class Z{static fromPosition(e){return a.data.MercatorPoint.fromPosition(e)}static fromPositions(e){return a.data.MercatorPoint.fromPositions(e)}static toPosition(e){return a.data.MercatorPoint.toPosition(e)}static toPositions(e){return a.data.MercatorPoint.toPositions(e)}static toFloat32Array(e){return a.data.MercatorPoint.toFloat32Array(e)}static mercatorScale(e){return a.data.MercatorPoint.mercatorScale(e)}static meterInMercatorUnits(e){return a.data.MercatorPoint.meterInMercatorUnits(e)}}class _{static async createFromTemplate(e,t){const a=U.getMapReference(e);if(!a)return!1;if(N.isEmptyOrNull(t.id))return S.logMessage(e,o.Error,"ImageTemplateDef.id is null or empty.",t),!1;if(N.isEmptyOrNull(t.templateName))return S.logMessage(e,o.Error,"ImageTemplateDef.templateName is null or empty.",t),!1;const r=a.map;return r.imageSprite.hasImage(t.id)?(S.logMessage(e,o.Warn,"Image template already exists.",t),!1):(await r.imageSprite.createFromTemplate(t.id,t.templateName,t.color,t.secondaryColor),!0)}static hasImage(e,t){const a=U.getMapReference(e);return!!a&&a.map.imageSprite.hasImage(t)}static async add(e,t,a,o){const r=U.getMapReference(e);return!!r&&(await r.map.imageSprite.add(t,a,o),!0)}static clear(e){const t=U.getMapReference(e);if(!t)return!1;t.map.imageSprite.clear()}static getImageIds(e){const t=U.getMapReference(e);return t?t.map.imageSprite.getImageIds():[]}static remove(e,t){const a=U.getMapReference(e);if(!a)return!1;a.map.imageSprite.remove(t)}}class q{static getEasingNames(e){return this.#Pe(e)?[]:a.animations.getEasingNames()}static async animateShape(e,t){const a=N.parseJsonString(t);"SetCoordinates"===a.action?await this.setCoordinates(e,a):S.logMessage(e,o.Error,"Animations.animateShape: action not supported.",a)}static async setCoordinates(e,t){if(this.#Pe(e))return;const r=U.getMap(e);if(!r)return;const n="Animations.animateShape: ",s=r.sources.getById(t.dataSourceId);if(s)if(P.isDataSource(s)){let r=s.getShapeById(t.feature.id);if(!r)return void S.logMessage(e,o.Error,`${n}Shape not found where shapeId = '${t.feature.id}'.`,t);a.animations.setCoordinates(r,t.feature.geometry.coordinates,t.animationOptions),r.addProperty("heading",t.feature.properties.heading)}else S.logMessage(e,o.Error,`${n}DataSource not found where id = '${t.dataSourceId}'.`,t);else S.logMessage(e,o.Error,`${n}DataSource not found.`,t)}static#Pe(e){return!a.animations&&(S.logMessage(e,o.Trace,"Animations.setCoordinates: atlas.animations module not found."),!0)}}marqdoujAzureMaps=t})();